
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Скрипт для обработки и добавления вопросов о общежитии в базу знаний
Processing dormitory questions and adding to knowledge base
"""

import os
import sys

# Добавляем корневую директорию в путь для импорта модулей
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from app import app
from models import AgentKnowledgeBase, AdminUser
from app import db
from datetime import datetime

def process_dormitory_questions():
    """Обработка и добавление вопросов о общежитии в базу знаний"""

    # Данные вопросов и ответов о общежитии
    dormitory_qa = [
        {
            'title': 'Подача заявления на общежитие',
            'content_kz': 'Жатақханаға орналасуға өтінішті қалай берсек болады?\n\nУниверситеттің ресми сайтында немесе студенттік порталында "Жатақханаға өтініш" бөлімінде онлайн өтініш толтырылады. Кейде қабылдау бөліміне барып, қолмен де тапсыруға болады.',
            'content_ru': 'Как подать заявление на общежитие?\n\nНа официальном сайте университета или в студенческом портале в разделе "Заявление на общежитие" заполняется онлайн заявка. Иногда можно подать заявление лично в приемную комиссию.',
            'keywords': 'жатақхана, өтініш, заявление, общежитие, подача'
        },
        {
            'title': 'Необходимые документы для общежития',
            'content_kz': 'Жатақханаға орналасу үшін қажетті құжаттар:\n\n• Жеке куәлік (көшірмесі)\n• Студенттік билет\n• Оқу орнына қабылданғаны туралы бұйрық/анықтама\n• Медициналық анықтама (086-У, флюорография)\n• Әлеуметтік жағдайын растайтын құжаттар (жеңілдіктер үшін)\n• Фото 3x4 (2-4 дана)',
            'content_ru': 'Необходимые документы для общежития:\n\n• Удостоверение личности (копия)\n• Студенческий билет\n• Приказ/справка о зачислении в учебное заведение\n• Медицинская справка (086-У, флюорография)\n• Документы, подтверждающие социальное положение (для льгот)\n• Фото 3x4 (2-4 штуки)',
            'keywords': 'құжаттар, документы, жатақхана, общежитие, медсправка'
        },
        {
            'title': 'Стоимость общежития',
            'content_kz': 'Жатақханаға төлемі қанша?\n\nӘр университетте/қалада әртүрлі. Орта есеппен айына 3 000 – 15 000 теңге аралығында болады.',
            'content_ru': 'Сколько стоит общежитие?\n\nВ каждом университете/городе по-разному. В среднем в диапазоне от 3 000 до 15 000 тенге в месяц.',
            'keywords': 'төлем, стоимость, жатақхана, общежитие, теңге'
        },
        {
            'title': 'Список на общежитие',
            'content_kz': 'Жатақхана тізімі қашан шығады?\n\nӘдетте 20-30 тамыз аралығында университет сайтында жарияланады. Кейде қыркүйектің басында шығады.',
            'content_ru': 'Когда выходит список на общежитие?\n\nОбычно в период с 20-30 августа публикуется на сайте университета. Иногда выходит в начале сентября.',
            'keywords': 'тізім, список, жатақхана, общежитие, тамыз, август'
        },
        {
            'title': 'Сроки заселения в общежитие',
            'content_kz': 'Жатақханаға қай күндері орналаса аламыз?\n\n25 тамыз – 5 қыркүйек аралығы (нақты күнді университеттен сұраған жөн).',
            'content_ru': 'В какие дни можно заселиться в общежитие?\n\n25 августа – 5 сентября (точную дату лучше уточнить в университете).',
            'keywords': 'орналасу, заселение, мерзім, сроки, тамыз, август'
        },
        {
            'title': 'Необходимые вещи для общежития',
            'content_kz': 'Жатақханаға қандай заттар қажет?\n\n**Жеке заттар:**\n• Көрпе, жастық, төсек жаймасы\n• Ыдыс-аяқ\n• Киім\n\n**Гигиеналық құралдар**\n\n**Кішкене электрлі құрылғылар:**\n• Шаш кептіргіш\n• Термопот\n• Т.б.',
            'content_ru': 'Какие вещи нужны для общежития?\n\n**Личные вещи:**\n• Одеяло, подушка, постельное белье\n• Посуда\n• Одежда\n\n**Гигиенические средства**\n\n**Небольшие электрические приборы:**\n• Фен для волос\n• Термопот\n• И т.д.',
            'keywords': 'заттар, вещи, көрпе, одеяло, жатақхана'
        },
        {
            'title': 'Количество человек в комнате',
            'content_kz': 'Бөлмелерде қанша адам орналаса алады?\n\n2-4 адамнан тұратын бөлмелер жиі кездеседі.',
            'content_ru': 'Сколько человек размещается в комнатах?\n\nЧасто встречаются комнаты на 2-4 человека.',
            'keywords': 'бөлме, комната, адам, человек, орналасу'
        },
        {
            'title': 'Льготы при получении общежития',
            'content_kz': 'Жатақхана алу үшін қандай жеңілдіктер бар?\n\nӘлеуметтік аз қамтылғандар, жетімдер, мүгедектер, көпбалалы отбасы балалары, ауылдан келгендерге және 1-курс студенттеріне басымдық беріледі.',
            'content_ru': 'Какие льготы есть для получения общежития?\n\nПриоритет отдается социально незащищенным, сиротам, инвалидам, детям из многодетных семей, приезжим из сел и студентам 1 курса.',
            'keywords': 'жеңілдіктер, льготы, басымдық, приоритет, жетім'
        },
        {
            'title': 'Мероприятия в общежитии',
            'content_kz': 'Жатақханада іс-шаралар ұйымдастырыла ма?\n\nИә, студенттерге арналған мәдени, спорттық, тәрбиелік іс-шаралар өткізіледі.',
            'content_ru': 'Организуются ли мероприятия в общежитии?\n\nДа, проводятся культурные, спортивные, воспитательные мероприятия для студентов.',
            'keywords': 'іс-шаралар, мероприятия, мәдени, культурные, спорт'
        },
        {
            'title': 'Персонал общежития',
            'content_kz': 'Жатақханада тәрбиеші болады ма?\n\nӘр жатақханада тәрбиеші (воспитатель) және комендант жұмыс істейді.',
            'content_ru': 'Есть ли воспитатель в общежитии?\n\nВ каждом общежитии работает воспитатель и комендант.',
            'keywords': 'тәрбиеші, воспитатель, комендант, персонал'
        },
        {
            'title': 'Кухня в общежитии',
            'content_kz': 'Бөлмелерде жеке ас бөлмесі бар ма?\n\nКөп жағдайда ас бөлмесі ортақ болады. Аздаған жатақханаларда әр қабатта немесе жалпы ас бөлмесі бар.',
            'content_ru': 'Есть ли отдельная кухня в комнатах?\n\nВ большинстве случаев кухня общая. В некоторых общежитиях есть кухня на каждом этаже или общая кухня.',
            'keywords': 'ас бөлмесі, кухня, ортақ, общая, қабат'
        },
        {
            'title': 'Размещение студентов старших курсов',
            'content_kz': 'Жоғары курс білім алушыларына орналасуға болады ма?\n\nИә, бірақ бірінші кезекте 1-курс студенттері орналасады.',
            'content_ru': 'Могут ли размещаться студенты старших курсов?\n\nДа, но в первую очередь размещаются студенты 1 курса.',
            'keywords': 'жоғары курс, старшие курсы, орналасу, размещение'
        },
        {
            'title': 'Правила порядка в общежитии',
            'content_kz': 'Жатақханада тәртіп қалай?\n\nАрнайы ішкі тәртіп ережесі бар. Тыныштық, тазалық, қауіпсіздік сақталуы тиіс.',
            'content_ru': 'Как соблюдается порядок в общежитии?\n\nЕсть специальные правила внутреннего распорядка. Должны соблюдаться тишина, чистота, безопасность.',
            'keywords': 'тәртіп, порядок, ереже, правила, тыныштық'
        },
        {
            'title': 'Сохранение места при отъезде',
            'content_kz': 'Жатақханада жатып, ұзақ уақытқа ауылға қайтып кеткен жағдайда орнымыз сақтала ма?\n\nСебебін ресми түрде комендантқа немесе тәрбиешіге айтсаңыз, орныңыз сақталады.',
            'content_ru': 'Сохраняется ли место при длительном отъезде в село?\n\nЕсли официально сообщить причину коменданту или воспитателю, ваше место сохраняется.',
            'keywords': 'орын сақтау, сохранение места, кету, отъезд, ауыл'
        },
        {
            'title': 'Оплата общежития по частям',
            'content_kz': 'Жатақхана төлемін бөліп төлеуге болады ма?\n\nКөп жағдайда ай сайын төлеуге мүмкіндік бар. Толығырақ университеттің қаржы бөліміне хабарласыңыз.',
            'content_ru': 'Можно ли оплачивать общежитие по частям?\n\nВ большинстве случаев есть возможность платить ежемесячно. Подробнее обращайтесь в финансовый отдел университета.',
            'keywords': 'төлем, оплата, бөліп, по частям, қаржы бөлім'
        },
        {
            'title': 'Нарушение правил общежития',
            'content_kz': 'Ішкі тәртіп ережесін бұзған жағдайда жатақханадан бірден шығарма әлде сөгіс береді ме?\n\nАлдымен ескерту немесе сөгіс беріледі, қайталанса – шығарылуы мүмкін.',
            'content_ru': 'При нарушении правил внутреннего распорядка сразу исключают из общежития или делают выговор?\n\nСначала дается предупреждение или выговор, при повторении - возможно исключение.',
            'keywords': 'бұзу, нарушение, ереже, правила, ескерту, предупреждение'
        },
        {
            'title': 'Студенческий совет общежития',
            'content_kz': 'Жатақханада студенттік кеңес жұмыс атқарады ма?\n\nИә, студенттік кеңес, өзін-өзі басқару ұйымы бар.',
            'content_ru': 'Работает ли студенческий совет в общежитии?\n\nДа, есть студенческий совет, организация самоуправления.',
            'keywords': 'студенттік кеңес, студенческий совет, өзін-өзі басқару'
        },
        {
            'title': 'Куда обращаться за местом в общежитии',
            'content_kz': 'Жатақханадан орын алу үшін кімге жүгінеміз?\n\nУниверситеттің жатақхана бөлімі, деканат немесе қабылдау комиссиясына.',
            'content_ru': 'К кому обращаться для получения места в общежитии?\n\nК отделу общежитий университета, в деканат или приемную комиссию.',
            'keywords': 'жүгіну, обращение, жатақхана бөлім, отдел общежитий'
        },
        {
            'title': 'Видеонаблюдение в общежитии',
            'content_kz': 'Іште бейнебақылау жүргізіледі ме?\n\nКөптеген жатақханаларда қауіпсіздік үшін бейнебақылау бар.',
            'content_ru': 'Ведется ли видеонаблюдение внутри?\n\nВо многих общежитиях есть видеонаблюдение для безопасности.',
            'keywords': 'бейнебақылау, видеонаблюдение, қауіпсіздік, безопасность'
        },
        {
            'title': 'Приоритет для жителей пригорода',
            'content_kz': 'Қала маңында тұрамыз, маған орын бөлінеді ме?\n\nӘдетте ауылдан келгендерге басымдық беріледі. Бірақ қала маңында тұратындар да өтініш бере алады, шешімді комиссия қабылдайды.',
            'content_ru': 'Живем в пригороде, мне выделят место?\n\nОбычно приоритет отдается приезжим из сел. Но жители пригорода тоже могут подать заявление, решение принимает комиссия.',
            'keywords': 'қала маң, пригород, басымдық, приоритет, ауыл'
        },
        {
            'title': 'Приоритет по курсам',
            'content_kz': 'Бірінші кезекте қай курс студенттеріне бөлінеді орын?\n\n1-курс, әлеуметтік жағдайы төмен, жетім және ерекше топтарға.',
            'content_ru': 'В первую очередь каким студентам выделяются места?\n\n1 курс, социально незащищенным, сиротам и особым группам.',
            'keywords': '1-курс, первый курс, басымдық, приоритет, жетім'
        },
        {
            'title': 'Бесплатное проживание для сирот',
            'content_kz': 'Ата-анасының қамқорлығынсыз қалған студентке тегін жатуға рұқсат бар ма екен?\n\nИә, "жетім" немесе "ата-анасының қамқорлығынсыз қалған" студенттерге тегін немесе жеңілдікпен орын беріледі.',
            'content_ru': 'Есть ли право на бесплатное проживание для студентов, оставшихся без попечения родителей?\n\nДа, "сиротам" или студентам "оставшимся без попечения родителей" предоставляется место бесплатно или со льготой.',
            'keywords': 'жетім, сирота, тегін, бесплатно, қамқорлық, попечение'
        }
    ]

    with app.app_context():
        try:
            # Получаем админа для назначения как создателя записей
            admin = AdminUser.query.filter_by(username='admin').first()
            if not admin:
                print("❌ Админ пользователь не найден. Запустите init_sample_data.py")
                return False

            print("🔄 Начинаем добавление вопросов о общежитии...")

            added_count = 0
            updated_count = 0

            for qa in dormitory_qa:
                # Проверяем, существует ли уже такая запись
                existing = AgentKnowledgeBase.query.filter_by(
                    agent_type='dormitory',
                    title=qa['title']
                ).first()

                if existing:
                    # Обновляем существующую запись
                    existing.content_ru = qa['content_ru']
                    existing.content_kz = qa['content_kz']
                    existing.keywords = qa['keywords']
                    existing.updated_at = datetime.utcnow()
                    updated_count += 1
                    print(f"📝 Обновлено: {qa['title']}")
                else:
                    # Создаем новую запись
                    knowledge_entry = AgentKnowledgeBase(
                        agent_type='dormitory',
                        title=qa['title'],
                        content_ru=qa['content_ru'],
                        content_kz=qa['content_kz'],
                        keywords=qa['keywords'],
                        category='Общежитие',
                        priority=1,
                        is_active=True,
                        is_featured=True,
                        created_by=admin.id,
                        created_at=datetime.utcnow(),
                        updated_at=datetime.utcnow()
                    )
                    db.session.add(knowledge_entry)
                    added_count += 1
                    print(f"✅ Добавлено: {qa['title']}")

            # Сохраняем изменения
            db.session.commit()

            print(f"\n🎉 Успешно завершено:")
            print(f"   ➕ Добавлено новых записей: {added_count}")
            print(f"   📝 Обновлено существующих: {updated_count}")
            print(f"   📊 Всего обработано: {len(dormitory_qa)} записей")
            print(f"\n💡 Записи добавлены для агента 'dormitory'")

            return True

        except Exception as e:
            print(f"❌ Ошибка при добавлении данных: {str(e)}")
            db.session.rollback()
            return False

if __name__ == "__main__":
    print("=== Обработка вопросов о общежитии ===")
    success = process_dormitory_questions()

    if success:
        print("\n✅ Все вопросы успешно добавлены в базу знаний!")
        print("🔗 Теперь агент общежития сможет отвечать на эти вопросы")
    else:
        print("\n❌ Произошла ошибка при обработке")
        print("💡 Убедитесь, что база данных настроена и запущена")
